<!DOCTYPE html><html lang="en">  <head>    <meta charset="utf-8">    <meta http-equiv="X-UA-Compatible" content="IE=edge">    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">    <meta name="description" content="Ticketing Apps - <?php echo $perusahaan->nama; ?>">    <meta name="author" content="IT Department - <?php echo $perusahaan->nama; ?>">    <meta name="keywords" content="Ticketing Apps - <?php echo $perusahaan->nama; ?>">    <link rel="preconnect" href="https://fonts.gstatic.com/">    <link rel="shortcut icon" href="<?php echo base_url(); ?>upload/general_images/<?php echo $perusahaan->icon_name; ?>" />    <link rel="canonical" href="<?php echo base_url(); ?>" />    <title><?php echo $nama_halaman; ?> | <?php echo $perusahaan->nama; ?></title>    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&amp;display=swap" rel="stylesheet">    <!-- BEGIN SETTINGS -->    <!-- Remove this after purchasing -->    <link class="js-stylesheet" href="<?php echo base_url(); ?>assets/css/light.css" rel="stylesheet">    <link href="<?php echo base_url(); ?>assets/css/customs.css" rel="stylesheet">    <script src="<?php echo base_url(); ?>assets/js/settings.js"></script>    <style>      body {        opacity: 0;      }    </style>    <!-- END SETTINGS -->  </head>  <body data-theme="default" data-layout="fluid" data-sidebar-position="left" data-sidebar-layout="default">    <div class="wrapper">            <?php $this->load->view('adminx/components/sidebar'); ?>      <div class="main">        <?php $this->load->view('adminx/components/navbar'); ?>        <main class="content">          <div class="container-fluid p-0">            <div class="row">              <div class="col-12">                <div class="card table">                  <div class="card-header">                    <h5 class="card-title text-center">                      <?php echo $nama_halaman; ?>                      <span>                        <button type="button" class="btn btn-primary pull-right text-white" onclick="openModal();">                          <i class="align-middle me-1" data-feather="plus-circle"></i>                          TAMBAH                        </button>                      </span>                    </h5>                  </div>                  <div class="card-body">                    <div class="table-responsive">                      <table id="datatables-reponsive" class="table table-striped" width="150%">                        <thead>                          <tr class="bg-primary">                            <th class="text-white">No</th>                            <th class="text-white" width="150px">#</th>                            <th class="text-white" width="50px">Aktif?</th>                            <th class="text-white">No. Document</th>                            <th class="text-white" width="350px">Judul</th>                            <th class="text-white" width="150px">Perusahaan</th>                            <th class="text-white" width="150px">Tgl. Buat</th>                          </tr>                        </thead>                        <tbody></tbody>                      </table>                      <p>NOTE: Jadwal perawatan 3 bulan sekali.</p>                    </div>                  </div>                </div>              </div>            </div>          </div>        </main>        <?php $this->load->view('adminx/components/footer'); ?>      </div>    </div>        <!-- MODAL BUAT JADWAL -->    <div class="modal fade" id="modalForm" tabindex="-1" role="dialog" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">      <div class="modal-dialog" role="document">        <div class="modal-content">          <div class="modal-header">            <h5 class="modal-title">Default modal</h5>            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>          </div>          <div class="modal-body">            <form action="" method="post" id="registerForm">              <input type="hidden" value="" name="kode" >              <div class="form-group row mb-3">                <label class="col-sm-4 col-form-label">Perusahaan</label>                <div class="col-sm-8">                  <select id="perusahaan" name="perusahaan" class="form-select" onchange="get_nodoc();">                    <option selected disabled="disabled">-- Pilih --</option>                    <?php foreach ($perusahaan_all as $key => $value): ?>                      <option value="<?php echo $value->id; ?>"><?php echo $value->nama; ?></option>                    <?php endforeach ?>                  </select>                  <span class="help-block"></span>                </div>              </div>              <div class="form-group row mb-3">                <label class="col-sm-4 col-form-label">No. Document</label>                <div class="col-sm-8">                  <select id="no_doc" name="no_doc" class="form-select" required="required">                    <option selected="selected" disabled="disabled">-- Pilih --</option>                  </select>                  <span class="help-block"></span>                </div>              </div>              <div class="form-group row mb-3">                <label class="col-sm-4 col-form-label">Judul</label>                <div class="col-sm-8">                  <input type="text" name="judul" id="judul" class="form-control" required="required">                  <span class="help-block"></span>                </div>              </div>              <div class="form-group row mb-3">                <label class="col-sm-4 col-form-label">Aktivasi</label>                <div class="col-sm-8">                  <select id="aktivasi" name="aktivasi" class="form-select">                    <option selected="selected" disabled="disabled">-- Pilih --</option>                    <option value="AKTIF">AKTIF</option>                    <option value="DITUNDA">DITUNDA</option>                  </select>                  <span class="help-block"></span>                </div>              </div>              <div class="form-group row mb-3">                <label class="col-sm-4 col-form-label">                  Generate untuk<br><small>*Dimulai dari bulan <span class="text-danger fw-bolder"><?php echo date("M Y"); ?></span></small>                </label>                <div class="col-sm-8">                  <select id="generate" name="generate" class="form-select">                    <option selected="selected" disabled="disabled">-- Pilih --</option>                    <option value="1">1 Tahun</option>                    <option value="2">2 Tahun</option>                    <option value="3">3 Tahun</option>                  </select>                  <span class="help-block"></span>                </div>              </div>            </form>          </div>          <div class="modal-footer">            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>            <button type="button" id="btnSave" class="btn btn-primary" onclick="save();">Save</button>          </div>        </div>      </div>    </div>        <!-- MODAL JADWAL DETAIL -->    <div class="modal fade" id="modalJadwalDetail" tabindex="-1" role="dialog" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">      <div class="modal-dialog modal-lg" role="document">        <div class="modal-content">          <div class="modal-header">            <h5 class="modal-title">Jadwal perawatan detail</h5>            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>          </div>          <div class="modal-body">            <div class="table tabl-responsive">              <div class="container">                <div class="row">                  <div class="col-md-2"><h5>No. Document</h5></div>                  <?php                    if($this->session->userdata('user_perusahaan') == 1) {                    ?>                    <div class="col-md-4"><h5 class="nomor_document">: MAS/FO/IT/02</h5></div>                    <?php                    } else {                    ?>                    <div class="col-md-4"><h5 class="nomor_document">: MAIN/FO/IT/03</h5></div>                    <?php                    }                  ?>                  <!--div class="col-md-4"><h5 class="nomor_document" id="nomor_document">No. Document</h5></div-->                  <div class="col-md-2"><h5>Nama Perusahaan</h5></div>                  <div class="col-md-4"><h5 id="nama_perusahaan">Nama Perusahaan</h5></div>                </div>                <div class="row">                  <div class="col-md-2"><h5>Nama Document</h5></div>                  <div class="col-md-10"><h5 id="nama_document">No. Document</h5></div>                </div>              </div>              <table class="table table-striped table-bordered">                <thead>                  <tr class="bg-primary">                    <th class="text-white text-center">#</th>                    <th class="text-white text-center">No.</th>                    <th class="text-white text-center">Tgl. Perencana'an</th>                    <th class="text-white text-center">Jlh. Perangkat</th>                    <th class="text-white text-center">Dikerjakan oleh</th>                    <th class="text-white text-center">Status</th>                  </tr>                </thead>                <tbody id="isi_table"></tbody>              </table>            </div>          </div>          <div class="modal-footer">            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>          </div>        </div>      </div>    </div>    <!-- MODAL TRANSAKSI -->    <div class="modal fade" id="modalTransaksi" tabindex="-1" role="dialog" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">      <div class="modal-dialog modal-xl" role="document">        <div class="modal-content">          <div class="modal-header">            <h5 class="modal-title">Transaksi Perawatan - <span id="nama_perusahaan2"></span></h5>            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>          </div>          <div class="modal-body">            <div class="table tabl-responsive">              <div class="container">                <div class="row">                  <div class="col-md-2"><h5>No. Document</h5></div>                  <div class="col-md-4"><h5 id="nomor_document2">No. Document</h5></div>                  <div class="col-md-2"><h5>Nama Document</h5></div>                  <div class="col-md-4"><h5 id="nama_document2">Nama Document</h5></div>                </div>                <div class="row">                  <div class="col-md-2"><h5>Tgl. Rencana</h5></div>                  <div class="col-md-4"><h5 id="tanggal_rencana2">Tgl. Rencana</h5></div>                  <div class="col-md-2"><h5>Tgl. Realisasi</h5></div>                  <div class="col-md-4"><h5 id="tanggal_realisasi2">: <?php echo date('Y-m-d'); ?></h5></div>                </div>              </div>              <hr>              <form id="formTransaksi">                <input type="hidden" name="id_detail" id="id_detail">                <input type="hidden" name="jumlah_perangkat" id="jumlah_perangkat">                <table id="searchProdTable" class="table table-striped table-bordered" width="100%">                  <thead>                    <tr class="bg-primary">                      <th class="text-white text-center">No.</th>                      <th class="text-white text-center">                        <button type="button" class="btn btn-danger btn-sm" onclick="simpan_transaksi()">SIMPAN</button>                      </th>                      <th class="text-white text-center">Jenis</th>                      <th class="text-white text-center">Nama Perangkat</th>                      <th class="text-white text-center">User & Dept.</th>                    </tr>                  </thead>                  <tbody id="isi_item"></tbody>                </table>              </form>            </div>          </div>          <div class="modal-footer">            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>          </div>        </div>      </div>    </div>    <div id="loading-screen" class="loading">Loading</div>    <script src="<?php echo base_url(); ?>assets/js/app.js"></script>    <script src="<?php echo base_url(); ?>assets/js/datatables.js"></script>    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>    <script>      var save_method;      var url;      var id_jadwal;      //FUNGSI RESET FROM CHECKED TO UNCHECKED      function proses_unchecked(id_perangkat, id_trs_perawatan, id_jadwal_detail) {        $.ajax({          url: "<?php echo base_url(); ?>perawatan/proses_unchecked",          data: {            perangkat_id: id_perangkat,            perawatan_trs_id: id_trs_perawatan,            jadwal_detail_id: id_jadwal_detail          },          type: 'POST',          dataType: 'JSON',          beforeSend: function() {            $("#loading-screen").show();          },          success: function(hasil) {            console.log(hasil);            let id_detail       = localStorage.getItem('id_detail');            let tgl_perencanaan = localStorage.getItem('tgl_perencanaan');            let id_company      = localStorage.getItem('id_company');            open_modal_transaksi(id_detail, tgl_perencanaan, id_company);            lihat_jadwal(id_jadwal);          },          error: function(error) {            alert("Error when proses unchecked");          }        })      }      //FUNGSI SIMPAN TRANSAKSI      function simpan_transaksi() {        let id_detail         = $("#id_detail").val();        let jumlah_perangkat  = $("#jumlah_perangkat").val();        let jlh_item = [];        $("input:checkbox[name=id_perangkat]:checked").each(function() {          jlh_item.push($(this).val());        });        if (jlh_item.length > 0) {          $.ajax({            url: "<?php echo base_url(); ?>perawatan/perawatan_transaksi_save",            data: {              items: jlh_item,              id_details: id_detail,              jlh_perangkat: jumlah_perangkat            },            type: 'POST',            dataType: 'JSON',            beforeSend: function() {              $("#loading-screen").show();            },            success: function(hasil) {              console.log;              let res = hasil;              Swal.fire({                icon: res.status,                title: res.status.toUpperCase(),                text: res.message              })              lihat_jadwal(id_jadwal);              $("#loading-screen").hide();              //$('#modalTransaksi').modal('hide');              let id_detail       = localStorage.getItem('id_detail');              let tgl_perencanaan = localStorage.getItem('tgl_perencanaan');              let id_company      = localStorage.getItem('id_company');              open_modal_transaksi(id_detail, tgl_perencanaan, id_company)            },            error: function(error) {              alert("Error when proses data from controller");            }          })        } else {          alert("Silahkan pilih item dahulu!");        }      }      //FUNGSI OPEN MODAL TRANSAKSI      function open_modal_transaksi(id_detail, tgl_perencanaan, id_company) {        localStorage.setItem('id_detail', id_detail);        localStorage.setItem('tgl_perencanaan', tgl_perencanaan);        localStorage.setItem('id_company', id_company);        $.ajax({          url: "<?php echo base_url(); ?>perawatan/show_data_perangkat_by_company",          data: {            detail_id: id_detail,            plan_date: tgl_perencanaan,            company_id: id_company          },          type: 'POST',          dataType: 'JSON',          beforeSend: function() {            $("#loading-screen").show();          },          success: function(response) {            $('#nomor_document2').html(": " + response.header.document_id);            $('#nama_document2').html(": " + response.header.judul);            $('#tanggal_rencana2').html(": " + response.header.tgl_perencanaan);            $('#nama_perusahaan2').html(response.header.nama.toUpperCase());            $('#jumlah_perangkat').val(response.data.length);            $('#id_detail').val(id_detail);            $('#modalTransaksi').modal('show');            $("#loading-screen").hide();            var myTable;            myTable = $('#searchProdTable').DataTable({              data: response.table,              fixedHeader: {                header: true                // footer: true              },              order: [[1, 'asc']],                bSort: false,              bAutoWidth: false,              "bDestroy": true,              "pageLength": 50,              "aoColumns": [                { "No": "No" , "sClass": "text-center", "sWidth": "6%" },                { "#": "#" , "sClass": "text-center", "sWidth": "7%" },                { "Jenis": "Jenis" , "sClass": "text-left", "sWidth": "10%" },                { "Nama Perangkat": "Nama Perangkat" , "sClass": "text-left" },                { "Department": "Department" , "sClass": "text-center", "sWidth": "15%" }              ]            });          },          error: function(error) {            alert("Error when generate jadwal");          }        });      }      //FUNGSI GENERATE JADWAL      function generate_jadwal(id_detail, tgl_perencanaan, id_company) {        $.ajax({          url: "<?php echo base_url(); ?>perawatan/generate_jadwal",          data: {            detail_id: id_detail,            plan_date: tgl_perencanaan,            company_id: id_company          },          type: 'POST',          dataType: 'JSON',          beforeSend: function() {            $("#loading-screen").show();          },          success: function(response) {            let res = response;            Swal.fire({              icon: res.status,              title: res.status.toUpperCase(),              text: res.message            })            lihat_jadwal(id_jadwal);            $("#loading-screen").hide();          },          error: function(error) {            alert("Error when generate jadwal");          }        });      }      //FUNGSI GET NOMOR DOCUMENT      function get_nodoc(ids) {        var ids = $("#perusahaan :selected").val();        console.log(ids);        $.ajax({          url : "<?php echo base_url();?>perawatan/get_nodoc_by_perusahaan",          method : "POST",          data : {id: ids},          async : false,          dataType : 'json',          success: function(data){            var html = '';            var i;            html = '<option disabled>-- Pilih --</option>';            for(i = 0; i < data.length; i++){              html += '<option value="'+ data[i].nomor_doc +'">' +  data[i].nomor_doc + ' -- ' + data[i].nama_doc +'</option>';            }            $('#no_doc').html(html);            return data;          }        });      }      function get_nodoc2(company_id, document_id) {        $.ajax({          url : "<?php echo base_url();?>perawatan/get_nodoc_by_perusahaan",          method : "POST",          data : {id: company_id},          async : false,          dataType : 'json',          success: function(data){            var html = '';            var i;            html = '<option disabled>-- Pilih --</option>';            for(i = 0; i < data.length; i++){              if (document_id == data[i].nomor_doc) {                html += '<option selected value="'+ data[i].nomor_doc +'">' +  data[i].nomor_doc + ' -- ' + data[i].nama_doc +'</option>';              } else {                html += '<option value="'+ data[i].nomor_doc +'">' +  data[i].nomor_doc + ' -- ' + data[i].nama_doc +'</option>';              }            }            $('#no_doc').html(html);            return data;          }        });      }      //FUNCTION LIHAT JADWAL DETAIL      function lihat_jadwal(id) {        id_jadwal = id;        //console.log(id_jadwal);        $.ajax({          url : '<?php echo base_url(); ?>perawatan/lihat_jadwal_detail',          type: "POST",          data: {id_jadwal: id},          dataType: "JSON",          success: function(data)          {            $("#nama_document").html(": " + data.data[0].judul);            $("#nomor_document").html(": " + data.data[0].document_id);            $("#nama_perusahaan").html(": " + data.data[0].nama);            $('#modalJadwalDetail').modal('show');            $("#isi_table").html(data.table);          },          error: function (jqXHR, textStatus, errorThrown)          {            alert('Error adding / update data');          }        });      }      //FUNCTION OPEN MODAL CABANG      function openModal() {        save_method = 'add';        $("#pass_div").show();        $('#btnSave').text('Save');        $('#registerForm')[0].reset();        $('.form-group').find(".has-error").removeClass("has-error");        $('.help-block').empty();        $('#modalForm').modal('show');        $('.modal-title').text('Tambah Jadwal Perawatan');      };      //FUNCTION CLOSE MODAL      function closeModal(){        $('#registerForm')[0].reset();        $('#modalForm').modal('hide');        $('.modal-title').text('Tambah Jadwal Perawatan');      };      //FUNCTION RESET      function reset() {        $('#registerForm')[0].reset();        $('.modal-title').text('Tambah Jadwal Perawatan');      };      //FUNCTION RELOAD TABLE      function reload_table(){        table.ajax.reload(null,false);      };      //VALIDATION AND ADD USER      function save()      {        $("#btnSave").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Saving...');        $("#btnSave").attr('disabled', true);        var url;        if(save_method == 'add') {          $("#pass_div").show();          url = "<?php echo base_url(); ?>perawatan/perawatan_add";        } else {          $("#pass_div").hide();          url = "<?php echo base_url(); ?>perawatan/perawatan_update";        }                var data_save = $('#registerForm').serializeArray();        $.ajax({            url : url,            type: "POST",            data: data_save,            dataType: "JSON",            success: function(data)            {              if(data.status == 'ok')              {                $('#modalForm').modal('hide');                reload_table();              } else if (data.status == 'forbidden') {                Swal.fire(                  'FORBIDDEN',                  'Access Denied',                  'info',                );              } else if (data.status == 'error') {                Swal.fire(                  'ERROR',                  'Gagal input data',                  'error',                );              } else {                for (var i = 0; i < data.inputerror.length; i++)                 {                    $                    $('[name="'+data.inputerror[i]+'"]').parent().addClass('has-error');                    $('[name="'+data.inputerror[i]+'"]').next().text(data.error_string[i]);                }              }              $('#btnSave').text('Save');              $('#btnSave').attr('disabled',false);            },            error: function (jqXHR, textStatus, errorThrown)            {              alert('Error adding / update data');              $('#btnSave').text('Save');              $('#btnSave').attr('disabled',false);            }        });      };      //FUNCTION EDIT      function edit(id) {        save_method = 'update';        $('#registerForm')[0].reset();        $('.form-group').removeClass('has-error');        $(".form-group>div").removeClass("has-error");        $('.help-block').empty();        //Ajax Load data from ajax        $.ajax({          url : "<?php echo base_url(); ?>perawatan/perawatan_edit/" + id,          type: "GET",          dataType: "JSON",          success: function(data)          {            if (data.status == 'forbidden'){              Swal.fire(                'FORBIDDEN',                'Access Denied',                'info',              )            } else {              let company_id    = data.data.company_id;              let document_id   = data.data.document_id;              let isi = get_nodoc2(company_id, document_id);              $('[name="kode"]').val(data.data.id);              $('[name="perusahaan"]').val(data.data.company_id);              $('[name="no_doc"]').val(data.data.document_id);              $('[name="judul"]').val(data.data.judul);              $('[name="aktivasi"]').val(data.data.aktivasi);              $('[name="generate"]').val(data.data.generate_tahun);              $('#modalForm').modal('show');              $('.modal-title').text('Edit Jadwal Perawatan');              $('#btnSave').text('Update');            }          },          error: function (jqXHR, textStatus, errorThrown)          {            alert('Error get data from ajax');          }        });      }      //FUNCTION HAPUS      function openModalDelete(id) {      	Swal.fire({				  title: 'Apakah anda yakin?',				  text: "Data yang dihapus tidak bisa dikembalikan!",				  icon: 'warning',				  showCancelButton: true,				  confirmButtonColor: '#3085d6',				  cancelButtonColor: '#d33',				  confirmButtonText: 'Yes, hapus',				  cancelButtonText: 'Tidak, Batal'				}).then((result) => {				  if (result.isConfirmed) {				    $.ajax({              url: '<?php echo base_url(); ?>perawatan/perawatan_deleted/' + id,              type: 'DELETE',              error: function() {                alert('Something is wrong');              },              success: function(data) {                var result = JSON.parse(data);                if (result.status == 'forbidden'){                  Swal.fire(                    'FORBIDDEN',                    'Access Denied',                    'info',                  )                } else {                  $("#"+id).remove();                  reload_table();                }              }            });				  }				})      };      document.addEventListener("DOMContentLoaded", function(event) {        $("#loading-screen").hide();        table = $('#datatables-reponsive').DataTable({ 	      		"pagingType": "full_numbers",	      		"lengthMenu": [		          [10, 25, 50, -1],		          [10, 25, 50, "All"]		        ],		        responsive: false,		        language: {		          search: "_INPUT_",		          searchPlaceholder: "Search records",		        },            "processing": true,            "serverSide": true,            "order": [],            // Load data for the table's content from an Ajax source            "ajax": {              "url": "<?php echo base_url(); ?>perawatan/perawatan_list",              "type": "POST",            },            "aoColumns": [              { "No": "No" , "sClass": "text-right"},              { "#": "#" , "sClass": "text-center" },              { "Aktif": "Aktif" , "sClass": "text-center" },              { "No. Document": "No. Document" , "sClass": "text-left" },              { "Judul": "Judul" , "sClass": "text-left" },              { "Perusahaan": "Perusahaan" , "sClass": "text-left" },              { "Tgl. Buat": "Tgl. Buat" , "sClass": "text-left" }            ],            //Set column definition initialisation properties.            "columnDefs": [              {                 "targets": [ 0 ],                "orderable": false,                className: 'text-right'              },            ]        });        $("#judul").change(function(){          $(this).parent().removeClass('has-error');          $(this).next().empty();        });        $("#aktivasi").change(function(){          $(this).parent().removeClass('has-error');          $(this).next().empty();        });        $("#perusahaan").change(function(){          $(this).parent().removeClass('has-error');          $(this).next().empty();        });        $("#generate").change(function(){          $(this).parent().removeClass('has-error');          $(this).next().empty();        });      });    </script>  </body></html>